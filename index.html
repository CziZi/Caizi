<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title>è´ªåƒè›‡é¡¹ç›®</title>
		<style type="text/css">
			h1{
				text-align: center;
			}
			#score{
				text-align: center;
				font-size: 50px;
			}
			#snakeMap{
				margin: 0 auto;
				border: 3px solid red;
			}
			.row{
				height: 20px;
				/*border: 1px solid blue;*/
			}
			.col{
				height: 20px;
				width: 20px;
				border: 1px solid black;
				float: left;
				/*æ€ªå¼‚ç›’æ¨¡å‹*/
				box-sizing: border-box;
			}
			.moveSnake{
				background-color: greenyellow;
			}
			.food{
				background-color: gold;
			}
		</style>
	</head>
	<body>
		<h1>è´ªåƒè›‡</h1>
		<div id="score">0</div>
		<!--è›‡çˆ¬è¡Œåœ°å›¾éƒ¨åˆ†-->
		<div id="snakeMap">
			
		</div>
	</body>
	<script type="text/javascript">
		//è·å–ğŸæ‰€åœ¨åœ°å›¾å¯¹è±¡
		var snakeMap = document.getElementById("snakeMap");
		var score = document.getElementById("score");
		//ä¸ºäº†çµæ´»åˆ›å»ºåœ°å›¾,å°†åœ°å›¾çš„è¡Œæ•°å’Œåˆ—æ•°å­˜å‚¨åˆ°å˜é‡ä¸­
		var rowNumber = 20;//å­˜å‚¨è¡Œæ•°
		var colNumber = 14;//å­˜å‚¨åˆ—æ•°
		//çµæ´»çš„è®¾ç½®åœ°å›¾çš„é«˜åº¦å’Œå®½åº¦.ä¾‹å¦‚:è®¾ç½®æ¯ä¸ªè¡¨æ ¼çš„å®½åº¦å’Œé«˜åº¦ä¸º 20
		var smallDivW = 20;
		snakeMap.style.width = smallDivW * colNumber + "px";
		snakeMap.style.height = smallDivW * rowNumber + "px";
		var divsSnake = [];//äºŒç»´æ•°ç»„,ç”¨æ¥å­˜å‚¨åœ°å›¾ä¸Šæ‰€æœ‰ä½ç½®çš„è¡¨æ ¼div(ä¸ºäº†è·å–divæ‰€åœ¨çš„ä½ç½®)
		var rowArray;
		//ä½¿ç”¨åŒä¾§forå¾ªç¯åˆ›å»ºåœ°å›¾
		for (var i = 0;i < rowNumber;i++) {
			//åˆ›å»ºè¡Œæ‰€åœ¨çš„div(å¤§çš„)
			var rowDiv = document.createElement("div");
			//è®¾ç½®æ ·å¼
			rowDiv.className = "row";
			//æ·»åŠ åˆ°snakeMapåœ°å›¾ä¸Š
			snakeMap.appendChild(rowDiv);
			//åˆ›å»ºä¸€ä¸ªæ•°ç»„,ç”¨æ¥å­˜å‚¨æ¯ä¸€è¡Œä¸­æ‰€æœ‰çš„å°æ–¹æ ¼
			 rowArray = [];
			for (var j = 0;j < colNumber;j++) {
			//åˆ›å»ºæ¯ä¸€è¡Œä¸­æ‰€éœ€è¦çš„å°æ–¹å—div
			var colDiv = document.createElement("div");
			//è®¾ç½®å°æ–¹æ ¼çš„æ ·å¼
			colDiv.className = "col";
			//æ·»åŠ åˆ°æ‰€åœ¨çš„è¡Œä¸­
			rowDiv.appendChild(colDiv);
			//å°†è¯¥è¡Œçš„å°æ–¹å—æ·»åŠ åˆ°è¡Œæ•°ç»„ä¸­
			rowArray.push(colDiv);
			}
			//æœ€åå°†è¡Œæ•°ç»„é‡Œçš„divå…¨éƒ¨æ·»åŠ åˆ°äºŒç»´æ•°ç»„ä¸­
			divsSnake.push(rowArray);
		}
		
//		alert(divsSnake.length);
   console.log(divsSnake);
   //åˆ›å»ºæ•°ç»„,å­˜å‚¨ğŸèº«æ‰€å ç”¨çš„div
   var snakeBodys = [];
   for (var i = 0;i < 3;i++) {
   	//å­˜å‚¨ğŸèº«divåˆ°æ•°ç»„ä¸­
   	snakeBodys[i] = divsSnake[0][i];
   	//æˆ–è€…
// 	snakeBodys.push(divsSnake[0][i]);
    //è®¾ç½®ç§»åŠ¨çš„è›‡èº«é¢œè‰²,è®¾ç½®æ ·å¼
    divsSnake[0][i].className = 
    "moveSnake col";
   }
   //è®¾ç½®ä¸€ä¸ªå˜é‡,ç”¨æ¥å­˜å‚¨è›‡ç§»åŠ¨çš„æ–¹å‘
// right left top bottom åˆ†åˆ«ä»£è¡¨å››ä¸ªæ–¹å‘
   var directionSnake = "right";
   var changeDirect = true;//è®°å½•æ˜¯å¦æ”¹å˜æ–¹å‘
   //åˆ›å»ºä¸€ä¸ªå»¶æ—¶å™¨
   //æ·»åŠ é”®ç›˜äº‹ä»¶,é€šè¿‡é”®ç›˜çš„ä¸Š,ä¸‹,å·¦,å³å››ä¸ªæ–¹å‘,æ§åˆ¶è›‡ç§»åŠ¨çš„æ–¹å‘
   var timeOut;
   document.onkeydown = function (e){
   	clearTimeout(timeOut);
   	if (changeDirect == false) {
   		return;//åœ¨ç›¸éš”æ—¶é—´ä»¥å†…,è›‡ä¸ç§»åŠ¨
   	}
    var event1 = event || e;
    //åˆ¤æ–­å‡ ä¸ªç‰¹æ®Šæƒ…å†µ,ä¸ºäº†åˆç†æ€§(è›‡å¤´å’Œè›‡å°¾ä¸èƒ½äº¤æ¢æ–¹å‘)
    //è›‡å¤´å¾€å³ç§»åŠ¨,ç‚¹å‡»å·¦æŒ‰é”®,åˆ™æ“ä½œä¸æˆåŠŸ!
//  ç›´æ¥returnå³å¯
    if (directionSnake == "right" && event1.keyCode == 37) {
    	return;
    }else if(directionSnake == "left" && event1.keyCode == 39) {
    	//å¦‚æœè›‡ç§»åŠ¨çš„æ–¹å‘æ˜¯å‘å·¦,æ­¤æ—¶ç‚¹å‡»å³æŒ‰é”®,ä¸æ‰§è¡Œ
    	return;
    }else if(directionSnake == "top" && event1.keyCode == 40) {
    	return;
    }else if(directionSnake == "bottom" && event1.keyCode == 38) {
    	return;
    }
    //ç‚¹å‡»ä¸åŒçš„æŒ‰é”®(ä¸Šä¸‹å·¦å³æŒ‰é”®),è®¾ç½®è›‡ç§»åŠ¨çš„æ–¹å‘
    switch (event1.keyCode){
    	case 37:{//è›‡è¯¥å‘å·¦ç§»åŠ¨
    		directionSnake = "left";
    		break;
    	}
    	case 38:{//è›‡è¯¥å‘ä¸Šç§»åŠ¨
    		directionSnake = "top";
    		break;
    	}
    	case 39:{//è›‡è¯¥å‘å³ç§»åŠ¨
    		directionSnake = "right";
    		break;
    	}
    	case 40:{//è›‡è¯¥å‘ä¸‹ç§»åŠ¨
    		directionSnake = "bottom";
    		break;
    	}
    	default:
    		break;
    }
    //ä¸ºäº†é˜²æ­¢è¿ç»­å¿«é€Ÿå¤šæ¬¡ç‚¹å‡»æŒ‰é”®,é€ æˆbug,æˆ‘ä»¬å¤„ç†é”®ç›˜äº‹ä»¶æ—¶,ä½¿ç”¨ç›¸éš”æ—¶é—´å¤„ç†
   	changeDirect = false;
   	timeOut = setTimeout(function (){
   		changeDirect = true;
   	},300);
   }
   //è®¾ç½®è›‡å¤´æ‰€åœ¨çš„ä½ç½®(ä¹Ÿå°±æ˜¯è›‡å¤´divåœ¨äºŒç»´æ•°ç»„ä¸­çš„åæ ‡)
    var x = 2;
    var y = 0;//å­˜å‚¨è›‡å¤´åæ ‡
    var foodX = 0;
    var foodY = 0;//è®°å½•é£Ÿç‰©æ‰€åœ¨çš„ä½ç½®åæ ‡
    var scores = 0;//è®°å½•å¾—åˆ†
    //å¤„ç†è›‡çš„ç§»åŠ¨
    var timerMove = setInterval(function (){
    	clearTimeout(timeOut);
    	//æ”¹å˜çŠ¶æ€,ä»¥ä¾¿äºä¸‹æ¬¡å¯ä»¥ç‚¹å‡»é”®ç›˜æŒ‰é”®
    	changeDirect = true;
    	//åˆ¤æ–­è›‡ç§»åŠ¨çš„æ–¹å‘,ä»è€Œè®¾ç½®è›‡ç§»åŠ¨çš„ä½ç½®
    	switch (directionSnake){
    		case "right":{//å‘å³
    			x++;
    			break;
    		}
    		case "left":{//å‘å·¦
    			x--;
    			break;
    		}
    		case "top":{//å‘ä¸Š
    			y--;
    			break;
    		}
    		case "bottom":{//å‘ä¸‹
    			y++;
    			break;
    		}
    		default:
    			break;
    	}
    	//ä¸ºäº†åˆç†æ€§,åˆ¤æ–­è›‡ç¢°æ’åˆ°å¢™å£å°± game over
    	if (x < 0 || y < 0 || x >= colNumber || y >= rowNumber) {
    		//æ¸…é™¤è›‡ç§»åŠ¨çš„å®šæ—¶å™¨
    		clearInterval(timerMove);
    		alert("game over");
    		return;//ç»ˆæ­¢å‡½æ•°çš„æ‰§è¡Œ
    	}
    	//å¦‚æœè›‡åƒåˆ°è‡ªå·±çš„èº«ä½“,åˆ™game over
    	for (var i = 0;i < snakeBodys.length;i++) {
    		//å°†æ­¤æ—¶è›‡å¤´ç§»åŠ¨çš„ä½ç½®æ‰€åœ¨çš„divå’Œä¹‹å‰èˆèº«æ‰€åœ¨çš„æ‰€æœ‰divè¿›è¡Œå¯¹æ¯”,å¦‚æœç›¸åŒ,åˆ™è¯´æ˜åƒåˆ°èº«ä½“éƒ¨åˆ†,game over;
    		if (snakeBodys[i] == divsSnake[y][x]) {
    		//æ¸…é™¤è›‡ç§»åŠ¨çš„å®šæ—¶å™¨
    		clearInterval(timerMove);
    		alert("game over è›‡åƒåˆ°èº«ä½“!");
    		return;
    		}
    	}
     //è®¾ç½®è›‡èº«é•¿åº¦ç§»åŠ¨çš„è¿‡ç¨‹
     //å¦‚æœè›‡åƒåˆ°é£Ÿç‰©,åˆ™è›‡å¤´å’Œé£Ÿç‰©çš„ä½ç½®ä¸€è‡´
     if (foodX == x && foodY == y) {
     	//è¯´æ˜è›‡åƒåˆ°äº†é£Ÿç‰©
     	//æ”¹å˜è›‡å¤´é¢œè‰²
     	divsSnake[y][x].className = "moveSnake col";
     	//å°†è›‡å¤´æ‰€åœ¨çš„div,æ·»åŠ åˆ°è›‡èº«æ‰€åœ¨æ•°ç»„ä¸­
     	snakeBodys.push(divsSnake[y][x]);
     	//å¾—åˆ†åŠ 1
     	scores++;
     	//æ˜¾ç¤ºå¾—åˆ†
     	score.innerHTML = scores;
     	//ç»§ç»­éšæœºé£Ÿç‰©
     	ranFoods();
     }else{
     	//è¯´æ˜è›‡æœªåƒåˆ°é£Ÿç‰©,ç»§ç»­ç§»åŠ¨
     	//æ”¹å˜è›‡å°¾è¿™ä¸ªdivçš„é¢œè‰²
     	snakeBodys[0].className = "col";
     	//åˆ é™¤è›‡å°¾çš„div
     	snakeBodys.shift();
     	//æ·»åŠ è›‡å¤´
     	divsSnake[y][x].className = "moveSnake col";
     	//è›‡å¤´æ‰€åœ¨çš„divæ·»åŠ åˆ°è›‡èº«æ•°ç»„é‡Œ
     	snakeBodys.push(divsSnake[y][x]);
     }
 

    },300);
   
   //éšæœºå‡½æ•°
   function ranNum (m,n){
   return	Math.floor(Math.random() * (n - m + 1) + m);
   }
   //éšæœºé£Ÿç‰©
   function ranFoods (){
   	//éšæœºè¡Œä½ç½®ä¸‹æ ‡
   	foodY = ranNum(0,rowNumber - 1);
   	//éšæœºåˆ—ä½ç½®ä¸‹æ ‡
   	foodX = ranNum(0,colNumber - 1);
   	//å¦‚æœéšæœºçš„é£Ÿç‰©åœ¨è›‡èº«ä¸Š,åˆ™é‡æ–°éšæœºé£Ÿç‰©çš„ä½ç½®,ç›´åˆ°éšæœºå‡ºä¸åŒä½ç½®ä¸ºæ­¢;
   	if (divsSnake[foodY][foodX].className == "moveSnake col") {
   		//å¦‚æœéšæœºé£Ÿç‰©åœ¨è›‡èº«ä½“ä¸Š,åˆ™é‡æ–°éšæœºä½ç½®
   		ranFoods();//é‡æ–°éšæœº
   	}else{
   		//è®¾ç½®é£Ÿç‰©æ‰€åœ¨çš„ä½ç½®çš„é¢œè‰²
   		divsSnake[foodY][foodX].className = "food col";
   	}
   }
   //é¦–å…ˆ,éšæœºä¸€æ¬¡é£Ÿç‰©çš„ä½ç½®
   ranFoods();
		
	</script>
</html>
